<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">

{% load staticfiles %}

<link rel="stylesheet" type="text/css" href="{% static 'jobs_manager_app/css/bootstrap.min.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'jobs_manager_app/css/bootstrap-theme.min.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'jobs_manager_app/css/mod.css' %}" />

<script type="text/javascript" src="{% static 'jobs_manager_app/js/jquery-2.1.1.min.js' %}"></script>
<script type="text/javascript" src="{% static 'jobs_manager_app/js/bootstrap.min.js' %}"></script>
<style type="text/css">
    .popover{
        max-width:600px;
    }
</style>
<head>
    <title>{% block title %}{% endblock %}</title>
</head>
<body>
	{% block header %}
	<nav class="navbar navbar-inverse" role="navigation">
		<div class="container">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">Brand</a>
			</div>

			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li class="project-nav"><a href="{% url 'jobs_manager_app:project_index' %}">Projects</a></li>
					<li class="assignment-nav"><a href="{% url 'jobs_manager_app:assignment_index' %}">Assignments</a></li>
					<li class="task-nav"><a href="{% url 'jobs_manager_app:task_index' %}">Tasks</a></li>
					<li class="user-nav"><a href="{% url 'jobs_manager_app:user_index' %}">Users</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="#" id="popover-notif" data-container="body" data-toggle="popover" data-trigger="click" data-placement="left"><span class="glyphicon glyphicon-bell"></span></a></li>
				</ul>
			</div>
		</div>
	</nav>
	
	<script>
		$( "li.{{ tag }}-nav" ).toggleClass( "active" );
	</script>
	{% endblock %}
	
	<div class="container theme-showcase" role="main">
	
		{% if messages %}
	    	{% for message in messages %}
	    		<div {% if message.tags %} class="alert alert-{{ message.tags }} alert-dismissible"{% endif %}>
	    			<button type="button" class="close" data-dismiss="alert">
	    				<span aria-hidden="true">&times;</span>
	    				<span class="sr-only">Close</span>
	    			</button>
	  				{{ message }}
	  			</div>
	   		{% endfor %}
		{% endif %}

		{% block back_link %} {% endblock %}

		<h1>{% block starter %}{% endblock %}</h1>

		<div class="row">
			<div class="col-md-1"></div>
			<div class="col-md-10">
			
				{% block content %} {% endblock %}
				
				{% block form %}{% endblock %}
				
			</div>
			<div class="col-md-1"></div>
		</div>

	</div>




	<hr>
    <div class="container">
	{% block footer %}
		<p id="bla"> R. GÃ³mez </p>
		{% if user.is_authenticated %}
			<a href="{% url 'logout_next' 'jobs_manager_app:project_index' %}">
				Log out 
			</a>
		{% else %}
			<a href="{% url 'login' %}">
				Log in
			</a>
		{% endif %}
	{% endblock %}
	</div>
    

<div id="modals">
{% block modals %}
{% endblock %}
</div>

</body>
</html>



<!-- POPOVER!! -->
<div class="popover-notif-head hide">Notifications</div>
<div class="popover-notif-content hide">
	<div class="list-notif">
	<!-- Waiting to be filled -->
	</div>
</div>

<script>
$(document).ready(function() {
	var formData =	{user_id: "{{ request.user_id }}", csrfmiddlewaretoken:'{{csrf_token}}' }
	
	$.ajax({
		url: "{% url 'jobs_manager_app:notif_user_list' %}",
		type: "POST",
		data: formData,
		success: function(response) {
			$(response).each(function() {
				var active = '';
				if (this.fields.bool_seen == false){
					active_class = 'list-group-item-warning';
				}else{
					active_class = 'disabled';
				}
				$('.list-notif').append(
			        $('<a>').attr('class', 'list-group-item '+active_class).attr('href', '#').attr('data-toggle', 'modal').attr('data-target', '#modal-notif-'+this.pk).append(
			            '<strong>'+this.fields.created+'</strong><br>'+this.fields.name
				));
				$('#modals').append(
					$('<div>').attr('class', 'modal fade').attr('id', 'modal-notif-'+this.pk).attr('tabindex', '1').attr('role', 'dialog').attr('aria-hidden', 'true').append(
						$('<div>').attr('class', 'modal-dialog modal-lg').append(
							$('<div>').attr('class', 'modal-content').append(
								$('<div>').attr('class', 'modal-header').append(
									$('<h4>').append(
										this.fields.name
									)
								),
								$('<div>').attr('class', 'modal-body').append(
										'<span style="white-space: pre-line">'+this.fields.description+'</span>'
								)
							)
						)
					)
				)
				
			});
			console.log(response)
		}

	})
	
})
</script>

<script>

$('#popover-notif').popover({ 
    html : true,
    title: function() {
      return $(".popover-notif-head").html();
    },
    content: function() {
      return $(".popover-notif-content").html();
    }
}).on('shown.bs.popover', function(e){
	$('.popover-content').on('click', function(e){
		$('#popover-notif').popover('hide');
	});
});


</script>
